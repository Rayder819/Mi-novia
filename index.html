<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nuestra Historia â¤ï¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none !important; } 
        .fade-in { animation: fadeIn 1s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        canvas { 
            border-radius: 24px; 
            touch-action: none; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            background: #1a1a1a; 
            transition: background 5s ease;
        }
        .allow-scroll { overflow-y: auto !important; overflow-x: hidden; }
        .btn-adventure { transition: all 0.2s; border: 2px solid #fecdd3; }
        .btn-adventure:active { transform: scale(0.95); background-color: #fff1f2; }
        
        /* Contenedor del CorazÃ³n */
        .heart-container { position: relative; width: 100px; height: 90px; margin: 0 auto; }
        
        /* Partes del CorazÃ³n */
        .heart-part { 
            position: absolute; 
            width: 50px; 
            height: 80px; 
            background: #e11d48; 
            border-radius: 50px 50px 0 0; 
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        .heart-left { transform: rotate(-45deg); left: 10px; transform-origin: 100% 100%; }
        .heart-right { transform: rotate(45deg); right: 10px; transform-origin: 0% 100%; }

        /* Estado Desbloqueado */
        .unlocked .heart-left { transform: rotate(-110deg) translateX(-40px); opacity: 0; }
        .unlocked .heart-right { transform: rotate(110deg) translateX(40px); opacity: 0; }
        .unlocked #lock-icon { transform: scale(0); opacity: 0; transition: all 0.5s; }
    </style>
</head>
<body id="main-body" class="bg-rose-50 text-slate-800 font-sans min-h-screen flex flex-col items-center justify-center p-4 overflow-hidden">

    <div id="start-screen" class="text-center fade-in max-w-sm">
        <div class="text-6xl mb-6">ğŸ’Œ</div>
        <h1 class="text-4xl font-extrabold text-rose-600 mb-4">Â¡Hola Amor!</h1>
        <p class="mb-8 text-lg text-rose-400 font-medium">He preparado un viaje por nuestra historia. Â¿Lista para empezar?</p>
        <button onclick="nextLevel('start-screen', 'quiz-screen')" class="bg-rose-500 text-white px-10 py-4 rounded-full text-xl font-bold shadow-xl active:scale-95 transition-all">
            Â¡Empezar!
        </button>
    </div>

    <div id="quiz-screen" class="hidden w-full max-w-md bg-white p-8 rounded-3xl shadow-2xl fade-in">
        <div class="flex justify-between items-center mb-6">
            <span class="text-rose-300 font-bold uppercase tracking-widest text-xs">MisiÃ³n 1: ReflexiÃ³n</span>
            <span id="progress" class="text-rose-500 font-bold">1/5</span>
        </div>
        <h2 class="text-2xl font-bold mb-4 text-slate-700" id="quiz-question">Cargando...</h2>
        <textarea id="user-input" rows="3" class="w-full p-4 border-2 border-rose-100 rounded-2xl focus:border-rose-400 focus:outline-none transition-colors resize-none mb-6" placeholder="Responde de corazÃ³n..."></textarea>
        <button onclick="handleQuizNext()" class="w-full bg-rose-500 text-white py-4 rounded-2xl font-bold text-lg shadow-lg active:scale-95 transition-all">Siguiente</button>
    </div>

    <div id="adventure-screen" class="hidden w-full max-w-md bg-white p-8 rounded-3xl shadow-2xl fade-in text-center">
        <span class="text-rose-300 font-bold uppercase tracking-widest text-xs mb-4 block">MisiÃ³n 2: Nuestra Aventura</span>
        <div id="adventure-content">
            <h2 id="adventure-question" class="text-2xl font-bold mb-6 text-slate-700"></h2>
            <div id="adventure-options" class="flex flex-col gap-4"></div>
        </div>
    </div>

    <div id="game-screen" class="hidden text-center fade-in w-full max-w-4xl">
        <h2 class="text-2xl font-bold mb-2 text-rose-500">MisiÃ³n 3: Nuestra Trayectoria</h2>
        <p class="mb-4 text-slate-500 italic text-sm">MantÃ©n presionado para elevar nuestro amor y recolectar los recuerdos</p>
        <div class="relative inline-block w-full">
            <canvas id="gameCanvas" width="800" height="400" class="w-full h-auto"></canvas>
            <div id="story-overlay" class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-0 transition-opacity duration-1000">
                <div class="bg-white/90 p-6 rounded-2xl shadow-xl text-xl font-bold text-rose-600 border-2 border-rose-200" id="story-text"></div>
            </div>
        </div>
    </div>

    <div id="lock-screen" class="hidden w-full max-w-md bg-white p-8 rounded-3xl shadow-2xl fade-in text-center">
        <span class="text-rose-300 font-bold uppercase tracking-widest text-xs mb-4 block">MisiÃ³n 4: Desbloquea mi CorazÃ³n</span>
        <div id="lock-visual" class="heart-container mb-8">
            <div class="heart-part heart-left"></div>
            <div class="heart-part heart-right"></div>
            <div class="absolute inset-0 flex items-center justify-center"><span id="lock-icon" class="text-3xl">ğŸ”’</span></div>
        </div>
        <h2 id="lock-question" class="text-xl font-bold mb-6 text-slate-700 italic"></h2>
        <div id="lock-options" class="grid grid-cols-1 gap-3"></div>
        <p id="lock-progress" class="mt-6 text-sm text-rose-300 font-bold"></p>
    </div>

    <div id="final-screen" class="hidden max-w-2xl w-full bg-white p-10 rounded-3xl shadow-2xl fade-in text-center my-8">
        <h2 class="text-4xl font-bold text-rose-600 mb-8 italic">Pese a todo, siempre tÃº...</h2>
        <div id="love-letter" class="text-lg text-slate-700 leading-relaxed text-left bg-rose-50 p-8 rounded-2xl border-l-8 border-rose-400 whitespace-pre-wrap mb-8 italic"></div>
        <div class="fade-in" style="animation-delay: 1.5s;"> 
            <img src="nosotros.JPG" alt="Nosotros" class="rounded-2xl mx-auto shadow-2xl border-4 border-white max-w-full h-auto mb-6">
            <p class="text-2xl font-bold text-rose-400 mb-4">Te amo para siempre. â¤ï¸</p>
        </div>
    </div>

    <script>
        const FORMSPREE_ID = "meelalrz"; 
        
        const questions = [
            "Â¿CuÃ¡l crees que fue el momento exacto en que supiste que valÃ­a la pena luchar por nosotros?",
            "Â¿QuÃ© sentiste ese dÃ­a en q nos dimos que somos muy compatibles a pesar de ser tan diferentes?",
            "Â¿CÃ³mo cambiÃ³ tu vida el dÃ­a que rescatamos a esos 7 cachorritos?",
            "Si pudieras decirnos algo a nosotros mismos cuando reciÃ©n empezÃ¡bamos y era difÃ­cil, Â¿quÃ© serÃ­a?",
            "Â¿QuÃ© es lo que mÃ¡s valoras de nuestra relaciÃ³n despuÃ©s de todo lo que hemos pasado?"
        ];

        const adventureData = {
            inicio: {
                q: "Cuando te vi por primera vez... Â¿quÃ© crees que hice?",
                options: [
                    { t: "Me hice el interesante ğŸ˜", next: "interesante" },
                    { t: "Me puse caliente ğŸ’¦", next: "caliente" },
                    { t: "Te hablÃ© directo ğŸ’¬", next: "directo" },
                    { t: "Me quedÃ© callado y te mirÃ© fijamente ğŸ‘€", next: "interesante" }
                ]
            },
            interesante: {
                q: "Trate de ser misterioso, pero no me salio DHDFJKA Â¿QuÃ© pensaste tÃº?",
                options: [
                    { t: "Que era un pesado ğŸ˜‚", next: "final_aventura" },
                    { t: "Que te llamÃ© la atenciÃ³n âœ¨", next: "final_aventura" },
                    { t: "Que era un poco raro pero me gustÃ³ ğŸ˜…", next: "final_aventura" },
                    { t: "Que me estabas mirando raro ğŸ‘€", next: "final_aventura" }
                ]
            },
            caliente: {
                q: "Se m paro a penas te vi... Si hubieras sabido esto Â¿Que habrias hecho? ğŸ˜³",
                options: [
                    { t: "Me habrÃ­a abrazado contigo ğŸ’", next: "final_aventura" },
                    { t: "Me habrÃ­a besado contigo ğŸ˜˜", next: "final_aventura" },
                    { t: "Te hubiera follado al frente del paulo", next: "final_aventura" },
                    { t: "Me meo", next: "final_aventura" }
                ]
            },
            directo: {
                q: "Fui directo al grano, no querÃ­a perder tiempo! Â¿Te asustÃ©?",
                options: [
                    { t: "Un poquito, pero me gustÃ³ ğŸ˜³", next: "final_aventura" },
                    { t: "No, me pareciÃ³ valiente ğŸ’ª", next: "final_aventura" },
                    { t: "Me sorprendiste pero me gustÃ³ ğŸ˜®â€ğŸ’¨", next: "final_aventura" },
                    { t: "Me dejaste sin palabras ğŸ˜¶", next: "final_aventura" }
                ]
            },
            final_aventura: {
                q: "Y sin importar el camino que tomamos ese dÃ­a o las decisiones que tomemos hoy...",
                options: [
                    { t: "SIEMPRE TE ELIJO A TI â¤ï¸", next: "FIN" }
                ]
            }
        };

        const lockQuestions = [
            { q: "Â¿DÃ³nde fue nuestra primera cita?", a: ["Mall Plaza", "En el Cine", "Tu casa", "Un parque"], correct: 0 },
            { q: "Â¿CuÃ¡l fue nuestra primera canciÃ³n?", a: ["Una de Kidd Voodoo", "Nuestra favorita", "La que pusiste en el auto", "La de la radio"], correct: 1 },
            { q: "Â¿QuiÃ©n se enamorÃ³ primero? ğŸ‘€", a: ["TÃº", "Yo", "Al mismo tiempo", "Fue el destino"], correct: 1 }
        ];

        let currentQ = 0;
        let userAnswers = [];
        let currentLockQ = 0;

        function nextLevel(hideId, showId) {
            document.getElementById(hideId).classList.add('hidden');
            document.getElementById(showId).classList.remove('hidden');
            if (showId === 'quiz-screen') document.getElementById('quiz-question').innerText = questions[currentQ];
            if (showId === 'adventure-screen') showAdventure('inicio');
            if (showId === 'game-screen') initSimbologia();
            if (showId === 'lock-screen') showLock(); // FIX: Mostrar la misiÃ³n 4
        }

        function handleQuizNext() {
            const val = document.getElementById('user-input').value.trim();
            if(!val) return alert("Escribe algo, amor... â¤ï¸");
            userAnswers.push({ q: questions[currentQ], a: val });
            currentQ++;
            if(currentQ < questions.length) {
                document.getElementById('progress').innerText = `${currentQ + 1}/${questions.length}`;
                document.getElementById('quiz-question').innerText = questions[currentQ];
                document.getElementById('user-input').value = "";
            } else {
                enviarRespuestas();
                nextLevel('quiz-screen', 'adventure-screen');
            }
        }

        function showAdventure(step) {
            const data = adventureData[step];
            document.getElementById('adventure-question').innerText = data.q;
            const container = document.getElementById('adventure-options');
            container.innerHTML = '';
            
            data.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "btn-adventure bg-white p-4 rounded-2xl font-semibold shadow-sm text-rose-500 border-2 border-rose-100 hover:bg-rose-50";
                btn.innerText = opt.t;
                btn.onclick = () => {
                    if(opt.next === "FIN") nextLevel('adventure-screen', 'game-screen');
                    else showAdventure(opt.next);
                };
                container.appendChild(btn);
            });
        }

        function showLock() {
            const data = lockQuestions[currentLockQ];
            document.getElementById('lock-question').innerText = data.q;
            document.getElementById('lock-progress').innerText = `Paso ${currentLockQ + 1} de ${lockQuestions.length}`;
            
            const container = document.getElementById('lock-options');
            container.innerHTML = '';
            
            data.a.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = "bg-rose-50 p-4 rounded-xl border-2 border-rose-100 font-bold text-rose-600 active:bg-rose-200 transition duration-200";
                btn.innerText = opt;
                btn.onclick = () => checkLock(i);
                container.appendChild(btn);
            });
        }

        function checkLock(index) {
            if(index === lockQuestions[currentLockQ].correct) {
                currentLockQ++;
                if(currentLockQ < lockQuestions.length) {
                    showLock();
                } else {
                    document.getElementById('lock-visual').classList.add('unlocked');
                    document.getElementById('lock-icon').innerText = "ğŸ’–";
                    
                    setTimeout(() => {
                        // Liberamos el scroll y pasamos a la carta
                        const body = document.getElementById('main-body');
                        body.classList.remove('overflow-hidden');
                        body.classList.add('allow-scroll');
                        nextLevel('lock-screen', 'final-screen');
                        typeWriter(); 
                    }, 1200);
                }
            } else {
                alert("Â¡Clave incorrecta! Intenta recordar bien nuestro inicio... â¤ï¸");
            }
        }

        async function enviarRespuestas() {
            try {
                await fetch(`https://formspree.io/f/${FORMSPREE_ID}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ respuestas: userAnswers })
                });
            } catch (e) { console.log("Sent"); }
        }

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const storyOverlay = document.getElementById('story-overlay');
        const storyText = document.getElementById('story-text');

        let gameActive = true;
        let speed = 2;
        let distance = 0;
        let player = { x: 50, y: 200, r: 20, vy: 0, gravity: 0.15, lift: -4 };
        let pressing = false;

        const milestones = [
            { d: 500, icon: 'ğŸ¤', text: "El dÃ­a del concierto de Kidd Voodoo... solo tÃº y yo sabemos." },
            { d: 1500, icon: 'ğŸ•', text: "Rescatamos 7 vidas... y ellos rescataron las nuestras." },
            { d: 2500, icon: 'ğŸ§', text: "Mi quequito y flores... porque te mereces todo cuando nadie mÃ¡s estÃ¡." },
            { d: 3500, icon: 'ğŸ‚', text: "Tu sorpresa de cumpleaÃ±os... cuando me demostraste tu amor infinito." },
            { d: 4500, icon: 'âœ¨', text: "Hoy: sueÃ±os, metas por cumplir y un amor que nada rompe." }
        ];

        function initSimbologia() {
            window.addEventListener('touchstart', (e) => { 
                if(gameActive) { e.preventDefault(); pressing = true; }
            }, {passive: false});
            window.addEventListener('touchend', () => pressing = false);
            requestAnimationFrame(gameLoop);
        }

        function gameLoop() {
            if(!gameActive) return;
            if (distance < 2000) canvas.style.background = `linear-gradient(to right, #2d3748, #fb7185)`;
            else canvas.style.background = `linear-gradient(to right, #fb7185, #fff1f2)`;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if(pressing) player.vy += player.lift;
            player.vy += player.gravity;
            player.y += player.vy;
            player.vy *= 0.7;
            if(player.y > canvas.height - 30) player.y = canvas.height - 30;
            if(player.y < 30) player.y = 30;
            ctx.font = "40px serif";
            ctx.fillText("â¤ï¸", player.x - 20, player.y + 15);
            milestones.forEach(m => {
                let xPos = m.d - distance;
                if(xPos > 0 && xPos < canvas.width) {
                    ctx.font = "50px serif";
                    ctx.fillText(m.icon, xPos, 200);
                    if(Math.abs(xPos - player.x) < 40) showStory(m.text);
                }
            });
            distance += speed;
            if(distance > 5000) finishGame();
            else requestAnimationFrame(gameLoop);
        }

        function showStory(txt) {
            storyText.innerText = txt;
            storyOverlay.style.opacity = 1;
            setTimeout(() => storyOverlay.style.opacity = 0, 3000);
        }

        function finishGame() {
            gameActive = false;
            // FIX: Ahora pasa a la misiÃ³n 4 (lock-screen) en lugar del final
            nextLevel('game-screen', 'lock-screen');
        }

        const loveText = `Nuestra relaciÃ³n no empezÃ³ en un jardÃ­n de rosas. Fue duro, difÃ­cil de manejar y hubo momentos donde el cielo parecÃ­a estar siempre gris. Pero nos mantuvimos fuertes. Nos elegimos cuando era mÃ¡s fÃ¡cil rendirse.

Hoy miro atrÃ¡s y veo todo lo que hemos construido de algunos momentos que siempre viven en mi cabeza. En el concierto de Kidd Voodoo, los 7 cachorritos que cuidamos con tanto amor, cuando te tatuaste mi inicial, las sorpresas en nuestros cumpleaÃ±os... esos momentos donde, cuando nadie mÃ¡s estaba, nosotros nos tenÃ­amos el uno al otro. 

Quiero que sepas algo hoy, en cualquier lugar del mundo: a pesar de cada discusiÃ³n o pelea que tengamos, yo por ti voy a luchar siempre. No importa quÃ© tan difÃ­cil se ponga el destino de nuestra vida, voy a seguir adelante porque mi Ãºnico objetivo es estar contigo. Eres mi paz, mi tranquilidad y mi hogar,

Y no hay nada que me haga mÃ¡s feliz que saber que tÃº tambiÃ©n sientes lo mismo por mÃ­. Te amo con todo mi corazÃ³n, y siempre lo harÃ©. Mi julieta (El Amor De Mi Vida) â¤ï¸`;

        let charIndex = 0;
        function typeWriter() {
            if (charIndex < loveText.length) {
                document.getElementById("love-letter").innerHTML += loveText.charAt(charIndex);
                charIndex++;
                setTimeout(typeWriter, 45);
            }
        }
    </script>
</body>
</html>