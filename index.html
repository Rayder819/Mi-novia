<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nuestra Historia ‚ù§Ô∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none !important; } 
        .fade-in { animation: fadeIn 1s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        canvas { 
            border-radius: 24px; 
            touch-action: none; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            background: #1a1a1a; 
            transition: background 5s ease;
        }
        /* Clase para permitir scroll solo al final */
        .allow-scroll { overflow-y: auto !important; overflow-x: hidden; }
    </style>
</head>
<body id="main-body" class="bg-rose-50 text-slate-800 font-sans min-h-screen flex flex-col items-center justify-center p-4 overflow-hidden">

    <div id="start-screen" class="text-center fade-in max-w-sm">
        <div class="text-6xl mb-6">üíå</div>
        <h1 class="text-4xl font-extrabold text-rose-600 mb-4">¬°Hola Amor!</h1>
        <p class="mb-8 text-lg text-rose-400 font-medium">He preparado unas preguntas para ti antes de mostrarte tu sorpresa. ¬øLista?</p>
        <button onclick="nextLevel('start-screen', 'quiz-screen')" class="bg-rose-500 text-white px-10 py-4 rounded-full text-xl font-bold shadow-xl active:scale-95 transition-all">
            ¬°Empezar!
        </button>
    </div>

    <div id="quiz-screen" class="hidden w-full max-w-md bg-white p-8 rounded-3xl shadow-2xl fade-in">
        <div class="flex justify-between items-center mb-6">
            <span class="text-rose-300 font-bold uppercase tracking-widest text-xs">Misi√≥n 1: Reflexi√≥n</span>
            <span id="progress" class="text-rose-500 font-bold">1/5</span>
        </div>
        <h2 class="text-2xl font-bold mb-4 text-slate-700" id="quiz-question">Cargando...</h2>
        <textarea id="user-input" rows="3" class="w-full p-4 border-2 border-rose-100 rounded-2xl focus:border-rose-400 focus:outline-none transition-colors resize-none mb-6" placeholder="Responde de coraz√≥n..."></textarea>
        <button onclick="handleQuizNext()" class="w-full bg-rose-500 text-white py-4 rounded-2xl font-bold text-lg shadow-lg active:scale-95 transition-all">Siguiente</button>
    </div>

    <div id="game-screen" class="hidden text-center fade-in w-full max-w-4xl">
        <h2 class="text-2xl font-bold mb-2 text-rose-500">Nuestra Trayectoria</h2>
        <p class="mb-4 text-slate-500 italic">Mant√©n presionado para elevar nuestro amor</p>
        <div class="relative inline-block w-full">
            <canvas id="gameCanvas" width="800" height="400" class="w-full h-auto"></canvas>
            <div id="story-overlay" class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-0 transition-opacity duration-1000">
                <div class="bg-white/90 p-6 rounded-2xl shadow-xl text-xl font-bold text-rose-600 border-2 border-rose-200" id="story-text"></div>
            </div>
        </div>
    </div>

    <div id="final-screen" class="hidden max-w-2xl w-full bg-white p-10 rounded-3xl shadow-2xl fade-in text-center my-8">
        <h2 class="text-4xl font-bold text-rose-600 mb-8 italic">Pese a todo, siempre t√∫...</h2>
        
        <div id="love-letter" class="text-lg text-slate-700 leading-relaxed text-left bg-rose-50 p-8 rounded-2xl border-l-8 border-rose-400 whitespace-pre-wrap mb-8"></div>
        
        <div class="fade-in" style="animation-delay: 1s;"> 
            <img src="nosotros.JPG" alt="Nosotros" class="rounded-2xl mx-auto shadow-2xl border-4 border-white max-w-full h-auto mb-6">
            <p class="text-2xl font-bold text-rose-400 mb-4">Te amo para siempre. ‚ù§Ô∏è</p>
        </div>
    </div>

    <script>
        const FORMSPREE_ID = "meelalrz"; 
        
        const questions = [
            "¬øCu√°l crees que fue el momento exacto en que supiste que val√≠a la pena luchar por nosotros?",
            "¬øQu√© sentiste ese d√≠a en q nos dimos que somos muy compatibles a pesar de ser tan diferentes?",
            "¬øC√≥mo cambi√≥ tu vida el d√≠a que rescatamos a esos 7 cachorritos?",
            "Si pudieras decirnos algo a nosotros mismos cuando reci√©n empez√°bamos y era dif√≠cil, ¬øqu√© ser√≠a?",
            "¬øQu√© es lo que m√°s valoras de nuestra relaci√≥n despu√©s de todo lo que hemos pasado?"
        ];

        let currentQ = 0;
        let userAnswers = [];

        function nextLevel(hideId, showId) {
            document.getElementById(hideId).classList.add('hidden');
            document.getElementById(showId).classList.remove('hidden');
            if (showId === 'quiz-screen') {
                document.getElementById('quiz-question').innerText = questions[currentQ];
            }
            if (showId === 'game-screen') {
                initSimbologia();
            }
        }

        function handleQuizNext() {
            const val = document.getElementById('user-input').value.trim();
            if(!val) return alert("Escribe algo, amor... ‚ù§Ô∏è");
            userAnswers.push({ q: questions[currentQ], a: val });
            currentQ++;
            if(currentQ < questions.length) {
                document.getElementById('progress').innerText = `${currentQ + 1}/${questions.length}`;
                document.getElementById('quiz-question').innerText = questions[currentQ];
                document.getElementById('user-input').value = "";
            } else {
                enviarRespuestas();
                nextLevel('quiz-screen', 'game-screen');
            }
        }

        async function enviarRespuestas() {
            try {
                await fetch(`https://formspree.io/f/${FORMSPREE_ID}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ respuestas: userAnswers })
                });
            } catch (e) { console.log("Sent"); }
        }

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const storyOverlay = document.getElementById('story-overlay');
        const storyText = document.getElementById('story-text');

        let gameActive = true;
        let speed = 2;
        let distance = 0;
        let player = { x: 50, y: 200, r: 20, vy: 0, gravity: 0.15, lift: -4 };
        let pressing = false;

        const milestones = [
            { d: 500, icon: 'üé§', text: "El d√≠a del concierto de Kidd Voodoo... solo tu y yo sabemos." },
            { d: 1500, icon: 'üêï', text: "Rescatamos 7 vidas... y ellos rescataron las nuestras." },
            { d: 2500, icon: 'üßÅ', text: "Mi quequito y flores... porque te mereces todo cuando nadie m√°s est√°." },
            { d: 3500, icon: 'üéÇ', text: "Tu sorpresa de cumplea√±os... cuando me demostraste tu amor infinito." },
            { d: 4500, icon: '‚ú®', text: "Hoy: sue√±os, metas por cumplir, mejorar cada uno y mutuamente porque nos elegimos y porque nos amamos" }
        ];

        function initSimbologia() {
            window.addEventListener('touchstart', (e) => { 
                if(gameActive) { e.preventDefault(); pressing = true; }
            }, {passive: false});
            window.addEventListener('touchend', () => pressing = false);
            requestAnimationFrame(gameLoop);
        }

        function gameLoop() {
            if(!gameActive) return;
            let colorVal = Math.min(distance / 20, 255);
            if (distance < 2000) canvas.style.background = `linear-gradient(to right, #2d3748, #fb7185)`;
            else canvas.style.background = `linear-gradient(to right, #fb7185, #fff1f2)`;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if(pressing) player.vy += player.lift;
            player.vy += player.gravity;
            player.y += player.vy;
            player.vy *= 0.7;
            if(player.y > canvas.height - 30) player.y = canvas.height - 30;
            if(player.y < 30) player.y = 30;
            ctx.font = "40px serif";
            ctx.fillText("‚ù§Ô∏è", player.x - 20, player.y + 15);
            milestones.forEach(m => {
                let xPos = m.d - distance;
                if(xPos > 0 && xPos < canvas.width) {
                    ctx.font = "50px serif";
                    ctx.fillText(m.icon, xPos, 200);
                    if(Math.abs(xPos - player.x) < 40) { showStory(m.text); }
                }
            });
            distance += speed;
            if(distance > 5000) finishGame();
            else requestAnimationFrame(gameLoop);
        }

        function showStory(txt) {
            storyText.innerText = txt;
            storyOverlay.style.opacity = 1;
            setTimeout(() => storyOverlay.style.opacity = 0, 3000);
        }

        function finishGame() {
            gameActive = false;
            // IMPORTANTE: Liberamos el scroll del body
            const body = document.getElementById('main-body');
            body.classList.remove('overflow-hidden');
            body.classList.add('allow-scroll');
            
            nextLevel('game-screen', 'final-screen');
            typeWriter();
        }

        const loveText = `Nuestra relaci√≥n no empez√≥ en un jard√≠n de rosas. Fue duro, dif√≠cil de manejar y hubo momentos donde el cielo parec√≠a estar siempre gris. Pero nos mantuvimos fuertes. Nos elegimos cuando era m√°s f√°cil rendirse.

Hoy miro atr√°s y veo todo lo que hemos construido de algunos momentos que siempre viven en mi cabeza. En el concierto de Kidd Voodoo, los 7 cachorritos que cuidamos con tanto amor, cuando te tatuaste mi inicial, las sorpresas en nuestros cumplea√±os... esos momentos donde, cuando nadie m√°s estaba, nosotros nos ten√≠amos el uno al otro. 

Quiero que sepas algo hoy, en cualquier lugar del mundo: a pesar de cada discusi√≥n o pelea que tengamos, yo por ti voy a luchar siempre. No importa qu√© tan dif√≠cil se ponga el destino de nuestra vida, voy a seguir adelante porque mi √∫nico objetivo es estar contigo. Eres mi paz, mi tranquilidad y mi hogar,

Y no hay nada que me haga m√°s feliz que saber que t√∫ tambi√©n sientes lo mismo por m√≠. Te amo con todo mi coraz√≥n, y siempre lo har√©. Mi julieta (El Amor De Mi Vida) ‚ù§Ô∏è`;

        let charIndex = 0;
        function typeWriter() {
            if (charIndex < loveText.length) {
                document.getElementById("love-letter").innerHTML += loveText.charAt(charIndex);
                charIndex++;
                setTimeout(typeWriter, 45);
            }
        }
    </script>
</body>
</html>