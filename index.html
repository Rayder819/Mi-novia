<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nuestra Misi√≥n ‚ù§Ô∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.6s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Estilos del Juego de Memoria */
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            perspective: 1000px;
        }
        .card {
            aspect-ratio: 1;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        .card.flipped { transform: rotateY(180deg); }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }
        .card-front { background: #fff; transform: rotateY(180deg); }
        .card-back { background: #fda4af; color: white; }
    </style>
</head>
<body class="bg-rose-50 text-slate-800 font-sans min-h-screen flex flex-col items-center justify-center p-4">

    <div id="start-screen" class="text-center fade-in max-w-sm">
        <div class="text-6xl mb-6">‚õèÔ∏è</div>
        <h1 class="text-4xl font-extrabold text-rose-600 mb-4">¬°Hola Amor!</h1>
        <p class="mb-8 text-lg text-rose-400 font-medium">Supera los niveles para llegar a tu sorpresa de San Valent√≠n.</p>
        <button onclick="nextLevel('start-screen', 'quiz-screen')" class="bg-rose-500 text-white px-10 py-4 rounded-full text-xl font-bold shadow-xl active:scale-95 transition-all">
            ¬°Empezar Misi√≥n!
        </button>
    </div>

    <div id="quiz-screen" class="hidden w-full max-w-md bg-white p-8 rounded-3xl shadow-2xl fade-in">
        <div class="flex justify-between items-center mb-6">
            <span class="text-rose-300 font-bold uppercase tracking-widest text-sm">Nivel 1: Quiz</span>
            <span id="progress" class="text-rose-500 font-bold">1/5</span>
        </div>
        <h2 class="text-2xl font-bold mb-4 text-slate-700" id="quiz-question">Cargando...</h2>
        <textarea id="user-input" rows="3" class="w-full p-4 border-2 border-rose-100 rounded-2xl focus:border-rose-400 focus:outline-none transition-colors resize-none mb-6" placeholder="Responde aqu√≠..."></textarea>
        <button onclick="handleQuizNext()" class="w-full bg-rose-500 text-white py-4 rounded-2xl font-bold text-lg shadow-lg active:scale-95 transition-all">
            Continuar
        </button>
    </div>

    <div id="game-screen" class="hidden text-center fade-in w-full max-w-md">
        <h2 class="text-2xl font-bold mb-2 text-rose-500">Nivel 2: Memory Match</h2>
        <p class="mb-6 text-slate-500 italic">Encuentra todos los pares de nuestra historia</p>
        <div id="memory-board" class="memory-grid">
            </div>
    </div>

    <div id="final-screen" class="hidden max-w-lg w-full bg-white p-8 rounded-3xl shadow-2xl fade-in text-center overflow-y-auto max-h-[90vh]">
        <img src="https://via.placeholder.com/400x300" id="final-photo" class="rounded-2xl mx-auto shadow-lg mb-6 border-4 border-rose-100">
        <h2 class="text-3xl font-bold text-rose-600 mb-6 italic">Para mi persona favorita...</h2>
        <div id="love-letter" class="text-lg text-slate-700 leading-relaxed text-left bg-rose-50 p-6 rounded-2xl border-l-4 border-rose-400"></div>
    </div>

    <script>
        const FORMSPREE_ID = "meelalrz"; 
        
        // --- QUIZ DATA ---
        const questions = [
            "¬øQu√© es lo primero que pensaste cuando nos conocimos?",
            "¬øCu√°l es tu momento favorito que hemos pasado juntos?",
            "Si pudi√©ramos teletransportarnos a un bioma de Minecraft ahora mismo, ¬øa cu√°l ir√≠amos?",
            "¬øQu√© es lo m√°s tierno que hace nuestro Yorkshire Terrier?",
            "¬øCu√°l es el plan perfecto para un s√°bado en La Cisterna?"
        ];

        let currentQ = 0;
        let userAnswers = [];

        // --- MEMORY GAME DATA ---
        // Emojis que representan su relaci√≥n: Palta, Yorkie, Minecraft, PC/C√≥digo, etc.
        const emojis = ['ü•ë', 'üê∂', '‚õèÔ∏è', 'üíª', 'üíñ', 'üçï', 'üåπ', 'üéÆ'];
        let cards = [...emojis, ...emojis];
        let flippedCards = [];
        let matchedPairs = 0;

        function nextLevel(hide, show) {
            document.getElementById(hide).classList.add('hidden');
            document.getElementById(show).classList.remove('hidden');
            if(show === 'quiz-screen') showQuestion();
            if(show === 'game-screen') initMemoryGame();
        }

        // --- LOGICA QUIZ ---
        function showQuestion() {
            document.getElementById('progress').innerText = `${currentQ + 1}/${questions.length}`;
            document.getElementById('quiz-question').innerText = questions[currentQ];
            document.getElementById('user-input').value = "";
        }

        function handleQuizNext() {
            const val = document.getElementById('user-input').value.trim();
            if(!val) return alert("¬°Dime algo bonito! ‚ù§Ô∏è");
            
            userAnswers.push({ q: questions[currentQ], a: val });
            currentQ++;

            if(currentQ < questions.length) showQuestion();
            else {
                enviarRespuestas();
                nextLevel('quiz-screen', 'game-screen');
            }
        }

        async function enviarRespuestas() {
            try {
                await fetch(`https://formspree.io/f/${FORMSPREE_ID}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ respuestas: userAnswers })
                });
            } catch (e) { console.log("Error silent"); }
        }

        // --- LOGICA MEMORY GAME ---
        function initMemoryGame() {
            const board = document.getElementById('memory-board');
            cards.sort(() => Math.random() - 0.5);
            
            cards.forEach((emoji, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.emoji = emoji;
                card.innerHTML = `
                    <div class="card-front">${emoji}</div>
                    <div class="card-back">?</div>
                `;
                card.onclick = () => flipCard(card);
                board.appendChild(card);
            });
        }

        function flipCard(card) {
            if(flippedCards.length < 2 && !card.classList.contains('flipped')) {
                card.classList.add('flipped');
                flippedCards.push(card);

                if(flippedCards.length === 2) {
                    setTimeout(checkMatch, 700);
                }
            }
        }

        function checkMatch() {
            const [c1, c2] = flippedCards;
            if(c1.dataset.emoji === c2.dataset.emoji) {
                matchedPairs++;
                if(matchedPairs === emojis.length) {
                    setTimeout(() => {
                        nextLevel('game-screen', 'final-screen');
                        typeWriter();
                    }, 500);
                }
            } else {
                c1.classList.remove('flipped');
                c2.classList.remove('flipped');
            }
            flippedCards = [];
        }

        // --- CARTA FINAL ---
        const loveText = "Desde mis d√≠as estudiando Ingenier√≠a hasta nuestras tardes en La Cisterna, t√∫ eres mi constante favorita. Gracias por apoyarme en cada c√≥digo y por ser la mejor compa√±era de vida. Te amo m√°s de lo que cualquier algoritmo podr√≠a calcular. ¬°Feliz San Valent√≠n! ‚ù§Ô∏è";
        let charIndex = 0;

        function typeWriter() {
            if (charIndex < loveText.length) {
                document.getElementById("love-letter").innerHTML += loveText.charAt(charIndex);
                charIndex++;
                setTimeout(typeWriter, 40);
            }
        }
    </script>
</body>
</html>